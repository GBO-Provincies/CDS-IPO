package filter;

import javax.xml.namespace.QName;

import org.deegree.cs.coordinatesystems.ICRS;
import org.deegree.cs.persistence.CRSManager;
import org.deegree.feature.persistence.query.Query;
import org.deegree.filter.Expression;
import org.deegree.filter.Filter;
import org.deegree.filter.OperatorFilter;
import org.deegree.filter.expression.ValueReference;
import org.deegree.filter.logical.And;
import org.deegree.filter.spatial.Overlaps;
import org.deegree.geometry.Geometry;
import org.deegree.geometry.io.WKTReader;
import org.deegree.protocol.wfs.getfeature.TypeName;
import org.junit.Test;

import com.vividsolutions.jts.io.ParseException;

/**
 * Created by huub on 2/10/2015.
 */
public class TestFilter {
    @Test
    public void testFilter() {
        TypeName[] typeNames = new TypeName[]{new TypeName(QName.valueOf("{http://www.deegree.org/app}Place"),
                null)
        };
        try {
            String drenthe = "MULTIPOLYGON(((268497.000037001 534372.900092263,268288.800085413 527419.600099316,268034.999943741 522320.800072121,267931.100053187 520002.299928625,267875.499965867 518778.100080414,267942.100079026 518624.999956786,267055.80003878 517432.199884092,266801.499932006 517450.099975302,266699.299922799 517609.800007015,266544.400020661 517665.399913691,266199.299902601 517607.500081607,265148.10006298 517794.000038023,264642.800015904 517999.199968103,264478.899948335 518253.399896773,264307.89997952 518389.300089689,264076.300073967 518380.400022107,263670.99999125 518273.200089207,263143.199927393 518520.40005152,263010.300076934 518656.100098256,262464.199901552 518819.499908194,262149.900014561 518399.900112315,262004.300058517 518295.100060869,261412.60008985 518289.49994733,261028.90008673 517954.300040099,260616.800081828 517994.800029379,260405.59994283 517988.30007734,260020.200058364 517791.900024707,259488.10009623 517979.400009758,259338.400029552 518059.100091545,258693.000039352 518001.600083645,258443.699980396 518246.100062279,258392.799961833 518677.799923736,258268.900078407 518813.499970472,257552.09991327 518952.300059159,257257.200061029 519225.100005447,256929.09994683 519249.799916834,255985.399944897 519117.599970322,255534.200089834 519414.100033451,254998.89995425 519046.70000007,254794.799914897 519031.600082675,254251.899912965 519000.300029114,254039.4000631 518881.600000998,253191.099949791 519222.699889905,252713.499953353 519147.499936976,252477.699944146 518937.099951628,251871.200016465 518781.900048774,251708.900035621 518846.699891169,251134.300063835 518926.99994332,250955.10007215 519160.60003119,250737.000017947 519218.500097362,250209.099961069 519079.299950403,249890.199998342 519287.599922435,249738.300085215 519211.299984824,249523.000033982 519245.100109973,249051.899980668 519150.900081153,248798.100037395 518965.70002151,248700.099933444 518962.300111422,248434.200041107 518588.89990623,247821.399957944 518799.799905894,247427.600064568 518487.599955006,247342.500052242 518599.999943173,247446.999900918 518702.600025258,247361.499916511 518731.099905005,247181.100008582 518580.899911237,246800.699973534 518455.699931082,246605.399915172 518272.300016618,246306.199966256 517795.600037022,245934.099947099 517473.400033871,245700.399989718 517063.399997894,245471.800073176 516891.200076419,244974.900035009 516714.099967814,244628.100035602 516411.199908691,244372.200040502 516308.700016741,244286.200090993 516379.099972675,244067.700064707 516350.600092928,243971.900005603 516387.900084211,243931.200068717 516509.599964143,243928.800037828 516616.300116814,244065.100047778 516725.500106984,244161.600058025 516998.300053273,244055.599917245 517163.900066662,244138.600076142 517257.399934984,244132.399913681 517365.399984427,244206.900070648 517427.10001896,244308.699909375 517668.09989737,244292.200069014 517788.799982756,244193.100041838 517907.400054825,244026.399971299 517903.399940284,243975.199973675 517941.099989839,243995.99991071 518023.900113578,244240.49990789 518125.100108756,244244.400032483 518240.800050966,244226.199913978 518405.900050037,244365.599905959 518583.800041097,244407.199978428 518743.000058492,242937.399992384 519277.100089943,240011.400063063 520501.799952472,239051.400008412 520954.300035,238007.600049099 521457.400115116,237555.600051474 521339.900027727,236439.799959102 521104.799896904,235756.600028006 520884.000035111,234213.100027556 520546.59992443,233768.599903259 520396.00010648,233373.600093637 520160.999931702,232290.800078784 519202.200005151,231256.700037646 518276.29989707,231444.800003343 516414.299950642,231647.299955971 514638.900096314,231689.899958644 514112.300045538,231575.300021312 514143.700055144,231569.600022351 514323.300001248,231395.200092444 514406.999963488,231371.999926122 514352.400085448,231209.099987156 514458.900091938,231198.099961316 514574.899902285,231158.999912756 514698.700029622,230904.200039279 514770.000058145,230697.000017894 514981.199925947,230257.499941414 515112.099975687,230022.600067789 515063.599991415,229903.000082639 515168.599954952,229728.399968292 515205.200019826,229433.399924631 515102.200113559,229408.099904881 515173.700054174,229175.800048185 515130.299935034,229065.699995169 515013.599964189,228977.999965914 515113.400106549,228848.200097486 515175.200097127,228736.699943786 515373.199914669,228553.100060806 515421.300074759,228437.30000883 515810.39993362,227927.900049518 515702.10001604,227863.699967247 515591.599895009,227912.899906065 515438.50000547,227736.699903391 515061.099919826,227722.099930419 514909.600029287,227614.499901312 514783.99999086,227370.800046695 514772.499895644,227210.79990532 514620.400034741,226857.799941851 514729.199966639,226500.700066146 514734.800080178,225950.000013427 515186.000031844,225987.899947343 515417.600062444,225749.399928186 516093.90009267,225542.700070302 516088.600081357,225400.30008931 515871.49999779,225406.100081291 515709.69995276,224886.700026344 515308.50002832,224880.900034363 515123.799982994,224728.899929817 515081.299936444,224534.000041935 515151.099922014,224238.800012234 515356.300086183,223961.499923578 515199.800052468,224039.600027678 514954.800059517,223869.499996046 514829.600079362,223662.699946743 514786.00004813,223400.49999456 514933.799926355,223170.699963374 514885.299942083,222983.29994882 514567.799979882,222702.19992699 514454.60010926,222553.799967976 514331.800010559,222458.200093312 514367.900061115,222513.799982232 514557.400103436,222459.500002577 514702.900056254,222271.700015942 514636.400024726,221999.699954164 514891.199923759,222016.299985943 515223.599891265,221766.299975845 515562.400088853,221867.300068807 515630.700031471,221874.899935155 515966.899967336,221813.200075193 516176.199968003,221683.300015346 516237.900002535,221622.900064649 516453.50004315,221491.800088557 516512.79996214,221479.099982972 516877.199909615,221171.400032125 517138.599950823,221061.099993069 517325.099907239,221148.800022324 517579.400026043,220983.000087368 517917.799931271,220640.300000196 518040.500073927,220428.600094494 518049.299951374,220342.599946586 518247.100090914,219932.400007471 518404.599919176,219711.199971236 518591.700080044,219582.000060931 518838.200115948,219428.100088997 518954.799896657,219190.699993064 518903.800074886,218911.900009102 519074.700099588,218917.500015042 519193.100025477,218765.800087956 519214.200114684,218615.800042217 519369.099915312,218498.500094935 519504.600049956,218488.000034197 519855.899903217,218654.199941235 520116.799930108,218578.500066423 520488.099887894,218341.799921632 520704.099986781,218001.90003583 520705.500073688,217634.600078449 520444.500090752,217126.600021423 520244.800084077,216896.200032114 520354.000074247,216582.199925786 520211.699885337,216423.900062556 519817.200059116,216227.900053051 519819.599940569,215847.000052902 519955.700045577,215700.399968255 520298.399933482,215338.200051712 520515.000002732,214938.999940038 520102.100070984,214744.700010279 520064.999991792,214437.899996616 520283.100103995,214408.60005765 520394.89988771,214408.50006463 520513.300047688,214048.899966617 520672.500065083,213943.100010277 520577.499919719,213887.399929937 520657.299957553,213678.400034185 520573.099980995,213215.100031659 520898.300070052,213230.399955774 521219.299898387,212931.399992899 521534.200067044,212564.5000076 521455.199911665,212198.899931566 521587.600004358,212282.600041606 521719.299936552,212132.000037745 521864.599977279,211790.900037298 521862.200095825,211540.000090016 521961.800092004,211526.200061207 521967.300015409,211420.099927406 522049.499934695,211240.999928742 522188.100111291,211269.799902606 522334.70004879,210960.800042494 522417.800040666,210790.10005274 522321.099940258,210843.500095212 522218.399902128,210345.399942402 522256.900068226,210281.700023632 522153.299957507,210095.299939283 522202.89992646,209644.100084219 521608.999961701,209601.800060607 521310.799943528,209423.599999127 521309.500046756,209384.799929628 521576.599923459,209142.999942399 521573.600071643,208984.500093128 521957.000095009,208691.700094315 521859.999892374,208779.09994611 521628.799920047,208821.299976702 521636.600002948,208914.700004917 521380.499973053,208764.299987097 521347.099906176,208847.899905718 521101.999957179,208753.199968237 521118.900019754,208056.899959473 521374.900093603,207438.800047831 521620.099998645,207882.800008627 522342.600087736,207774.100056296 522596.49991418,207595.200043673 522654.999950716,207414.299972243 522889.299964995,207286.999929326 522994.100016441,207150.799912396 522999.4999838,206918.900027781 522909.99999593,206994.599902594 523072.200099231,206961.800009516 523159.799985876,206558.499985606 524226.40004978,206639.500085697 524266.499980788,204471.999990204 529439.300020186,204453.400098017 529617.399923337,204584.400081088 529950.600007386,205062.900014708 530277.400095441,205320.600082575 530357.30008932,205453.499933033 530398.500005009,205763.499921748 530445.300034238,206928.699938977 530835.399921734,207111.300090153 531003.500006712,207143.80000417 531033.30001732,207361.900058374 531233.199936087,207437.499940167 531258.600007971,207783.300009369 531374.700008453,207817.100031051 531380.299887903,207761.19996467 531553.299925922,208068.999908537 532114.099926029,209019.500031054 533152.400022278,209202.699941953 533352.500087225,209196.19999883 533365.099933032,209451.500035807 533574.600079879,209554.499989178 533726.500028691,209915.000024374 534246.599893338,209614.799946855 534663.399983581,209252.600030312 535241.100046264,209259.899917599 535249.399909393,209247.399996454 535268.099883058,208297.000065356 536518.20005156,208153.19998368 536649.9999398,207877.699967789 536779.200034496,207715.899952047 536894.200050297,206914.499938086 537835.399987865,206363.199927244 538182.400092537,206511.500091636 538241.799967573,205388.80008406 539495.599914301,205089.899915806 539921.599940263,204957.300044409 540343.299983547,204343.500031042 541043.799910842,204500.399991986 541182.000029166,204852.400025252 541404.000065774,205791.199972387 542160.900016289,205959.499931253 542291.599919848,206952.900035504 543055.100012537,207446.600098618 543410.100112202,208637.900079762 544207.799920133,209816.799934381 544949.400041161,210159.800000614 545184.100113712,211848.799964087 547751.700086656,212361.29990543 548160.300035726,212650.999922211 548403.600073633,212801.899905134 548753.000059758,212906.59993825 548904.90000857,213419.100077992 549294.399925704,214691.699939889 549214.59988787,215245.59996766 549139.799993212,216528.399911232 549046.000022664,217974.499964252 547595.399965032,218664.00005083 546980.600057247,219353.799918071 547494.400116035,221088.800043708 548762.600053749,222467.400046385 549770.300022845,222736.499913773 550018.400057747,223801.899952684 552215.49995536,224907.199984317 554342.80010149,223956.300088118 555879.19990059,222977.099984758 557360.599997466,220802.79996708 560600.399930049,220448.500094346 561223.800037279,220456.099960694 561650.099931378,220546.79997896 563054.599886192,220605.40005529 563303.00002332,220711.799969753 564916.7999788,219630.800027666 565304.900043115,218276.599909158 565767.600089997,216532.600014887 566402.900116625,217144.599955488 567846.30006172,219110.900007617 567115.000095182,219923.700019499 569348.999925805,220389.300059893 569431.800049545,220532.499985049 571008.600115967,221217.10001683 572902.100028047,221467.300012969 573663.100049148,221593.099962182 574012.099977002,221528.49990783 574032.800007936,221525.099946738 574489.999897325,222086.300060195 575066.300107189,222172.599988765 575434.099964753,222245.800038068 575349.80003215,222504.700022179 575766.599888304,222767.399939464 575831.899979105,222978.700071483 576061.80005466,223051.899922387 576312.399927062,223062.299990104 576751.799915375,223125.799922833 577136.600025648,223289.500004361 577299.299909177,225433.49995447 578177.100091258,225711.59998729 578311.30009504,225808.399976598 578790.800014362,225870.40001402 579179.799917178,226107.499932493 579190.100071667,226311.799957888 579367.099990137,226578.699978827 579470.599910722,226762.200067187 579708.599937316,226812.799908289 579770.600074074,228276.09995121 580251.399890168,228402.800036005 580255.999975072,228402.300070903 580219.700012424,228504.09990963 580184.599990503,228566.499919135 580179.499891281,228619.000024423 580172.700071105,228816.299943193 579970.199890615,228870.899901909 579920.599921662,228870.099957746 579919.100112798,228918.999917502 579668.099948036,228924.499930422 579666.700095218,228928.000082933 579662.40011254,229031.899973488 579631.200015024,229164.300057243 579603.300105641,229780.399910079 579841.40008828,230051.800013734 579676.099943028,230315.200080561 579563.099984498,230415.400030962 579649.300018325,231174.999986413 579401.100027377,231190.299910528 579415.699930455,231404.200059477 579372.900015768,231444.300038241 579368.899901227,231788.000055617 579385.899919847,232106.900018343 578413.299972672,232145.299917362 578193.100081243,232303.699972011 578209.399939365,232374.599983446 578058.199916962,232463.499928946 578042.199926977,232626.800038392 577733.600032358,233375.399968004 576457.799923834,233470.600068986 576073.299915787,233686.600071363 575169.399969502,234818.500032013 575814.899960485,234797.800087998 575687.599967014,234870.000008698 575674.600062934,234860.700062604 575565.099970538,234955.300007065 575437.399918795,234983.800001867 575253.900048285,235248.100005877 575063.100109192,235055.799936526 574835.80006127,235061.599928507 574698.19991331,235132.699925983 574717.100033155,235273.100046567 574280.900042839,235301.200069288 574003.099953374,235328.499949447 573820.899979636,235850.899993405 573846.99997793,235854.199961477 573711.899901558,236116.80008414 573763.30001569,236576.399948114 573258.400024484,236707.799903266 573153.500016992,237085.499928364 572780.100045889,237105.800098696 572431.099883947,237308.900009447 572492.799918479,237316.099903713 572388.299969259,237397.100003804 572366.300041552,237429.19994574 572121.599916738,237599.899935494 571992.400056132,237595.300058156 571794.900018818,237847.900085184 571513.79997531,238018.600074938 571404.900087367,238001.400085036 571204.899978465,238059.000032764 571008.600115967,238160.600083849 571054.100014334,238222.399936832 570973.600050092,238033.800006033 570723.300045828,238192.700025784 570493.499926318,238433.400089789 570439.099960369,238606.599905053 570311.100040489,238543.799923467 570115.100046128,238654.899906687 569998.799899466,238647.899998461 569807.800048281,238543.199965345 569610.800025285,238540.299969354 569526.700004774,239987.099973516 570283.09994097,240998.200032771 570751.500057437,242535.600062179 571278.800034622,243606.099943528 571175.000011811,243721.000058321 571241.799911476,245422.69992898 571175.799894266,246100.500038576 570538.40008841,246226.299987789 570303.299957588,246330.700041844 570311.600054806,246412.099915617 570112.400062448,248048.999944283 568439.799968207,249000.899969085 567475.799986388,250660.799979633 565801.800039329,251479.799955578 564961.599950758,252606.700066809 563808.800087116,253855.500002659 562550.400055484,256277.000027465 560062.89998851,258964.099965547 557394.600034706,259215.900048412 557073.900074508,259842.099989904 556199.199934379,261295.199951148 554253.599981757,262016.699986642 553217.100030688,263020.299974171 551821.499909368,264435.69998754 549903.400041947,264504.799926208 549950.800041539,264510.599918189 549955.399892354,264769.70008674 549650.599966095,264938.300024666 549508.6001135,265225.000052437 549298.800098516,266552.300064469 548938.400031493,266540.299910027 548909.299947293,266383.099970021 548520.499956569,265469.800028677 546261.600068379,265460.400089563 546238.30000981,264610.500087927 544124.40006012,264600.599985312 544099.699914644,266286.499966754 544089.200082153,266478.500057044 543489.600047809,266537.800084517 543304.399988166,266696.299933788 543325.000063055,266847.700080211 543124.200071699,267048.399960074 542841.599985238,267060.099937056 542826.79993598,267327.199944036 542488.099928526,267860.400027793 541811.7998983,267931.000060166 541799.70006681,267958.799905427 541794.900069815,268089.599902457 541772.500083836,268169.500079324 541668.100090662,268337.600052148 541448.300023415,268716.899965572 541620.70009107,268808.399928002 541521.399963028,268589.299943594 541169.899963586,268524.29991716 541011.299916554,268492.899926367 540934.599920672,268475.099978343 540316.000044527,269921.500010423 540313.200104802,268568.100034477 537192.500024516,268497.000037001 534372.900092263)))";
            ICRS srs = CRSManager.getCRSRef("EPSG:28992");
            WKTReader reader = new WKTReader(srs);
            Geometry g = reader.read(drenthe);
            Query query = new Query(typeNames, null, null, null, null);
            Expression exp = new ValueReference(new QName("http://www.cds.nl/imna/beheer", "Geometrie", "imna"));

            Overlaps overlapsOperator = new Overlaps(exp, g);


            Filter filter = query.getFilter();
            Filter containsFilter = null;
            if (filter == null) {
                containsFilter = new OperatorFilter(overlapsOperator);
            } else {
                And andOperator = new And(overlapsOperator, ((OperatorFilter) filter).getOperator());
                containsFilter = new OperatorFilter(andOperator);
            }
            filter = containsFilter;
            query = new Query(query.getTypeNames(),containsFilter,null,null,null);

            System.out.println(query.getFilter());

        } catch (ParseException e) {
            e.printStackTrace();
        }
    }


}
